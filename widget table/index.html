<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DomWizard Table Widget</title>
    <!-- Load Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apply Inter font */
        html { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-blue-800 tracking-tight">DomWizard Table Widget Demo</h1>
            <p class="text-gray-500 mt-2">A fully styled, responsive, and pluggable table component.</p>
        </header>

        <!-- The table will be injected here -->
        <div id="table-container" class="shadow-xl rounded-lg bg-white p-2">
            <!-- Loading message while JavaScript executes -->
            <p class="p-8 text-center text-gray-400">Rendering Table Widget...</p>
        </div>

        <div id="output" class="mt-8 p-4 bg-gray-100 rounded-lg border border-gray-200">
            <h2 class="text-lg font-semibold text-gray-700">Action Log</h2>
            <ul id="log-list" class="mt-2 space-y-1 text-sm text-gray-600">
                <li class="text-gray-400">No actions yet. Click a row or cell!</li>
            </ul>
        </div>
    </div>

    <script>
        // --- MOCK DomWizard Environment ---
        
        // Mock function to simulate how DomWizard would handle element creation/injection
        // In a real DomWizard environment, this function would return a framework-specific element object.
        const DomWizard = {
            // This is the function that the Table widget must return (a DomWizard element)
            element: (htmlString) => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlString;
                return tempDiv.firstChild; // Return the actual DOM element
            }
        };

        // Utility function for logging user interactions
        const logAction = (message) => {
            const logList = document.getElementById('log-list');
            const listItem = document.createElement('li');
            listItem.className = 'py-1 border-b border-gray-200 last:border-b-0';
            listItem.innerHTML = `<span class="font-medium text-blue-600">${new Date().toLocaleTimeString()}</span>: ${message}`;
            
            // Clear the "No actions yet" message if present
            if (logList.querySelector('.text-gray-400')) {
                logList.innerHTML = '';
            }

            logList.prepend(listItem);
        };

        // Global functions for inline event handlers (must be global or accessible)
        window.handleRowClick = (dataJson, index, handlerName) => {
            const data = JSON.parse(decodeURIComponent(dataJson));
            logAction(`Row Clicked (Index: ${index}). Data: <span class="font-mono bg-gray-200 p-0.5 rounded">${data[handlerName]}</span>`);
            // Execute the actual user-provided function logic (mocked here)
            // onRowClick(data, index); 
        };

        window.handleCellClick = (dataJson, key, value, index) => {
            const data = JSON.parse(decodeURIComponent(dataJson));
            logAction(`Cell Clicked (Row: ${index}, Key: ${key}). Value: <span class="font-mono bg-gray-200 p-0.5 rounded">${value}</span>`);
            // Execute the actual user-provided function logic (mocked here)
            // onCellClick(data, key, value);
        };


        // --- The Table Widget Implementation ---

        /**
         * DomWizard Table Widget
         * Renders a fully styled, responsive HTML table.
         * @param {object} config - Configuration object.
         * @param {Array<object>} config.data - The main table data.
         * @param {Array<string|object>} config.columns - Column definitions.
         * @param {object} [config.styles={}] - Allows overriding default styles.
         * @param {string} [config.containerClasses=''] - Additional classes for the responsive container.
         * @param {function} [config.onRowClick] - Triggered when a row is clicked.
         * @param {function} [config.onCellClick] - Triggered when a cell is clicked.
         * @param {string} [config.caption] - Title above the table.
         * @param {string} [config.emptyMessage="No data to display."] - Message for empty data.
         * @returns {HTMLElement} A DomWizard element (simulated as an actual DOM element here).
         */
        const TableWidget = ({
            data,
            columns,
            styles = {},
            containerClasses = '', // Additional optional input for flexibility
            onRowClick,
            onCellClick,
            caption,
            emptyMessage = "No data to display."
        }) => {
            
            const processedColumns = columns.map(col => 
                (typeof col === 'string') 
                    ? { key: col, label: col.split(/(?=[A-Z])/).map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ') } 
                    : { key: col.key, label: col.label }
            );

            // Default responsive and aesthetic classes
            const defaultTableClasses = `w-full text-sm text-left text-gray-500 divide-y divide-gray-200 border border-gray-100 rounded-lg`;
            const defaultThClasses = `px-4 py-3 text-xs font-medium tracking-wider text-gray-700 uppercase bg-gray-50`;
            const defaultTdClasses = `px-4 py-3 font-normal text-gray-700 whitespace-nowrap`;
            const defaultRowClasses = `hover:bg-blue-50 transition-colors duration-150 ease-in-out`;
            
            // Combine default and user styles (simple string concatenation for demonstration)
            const tableClasses = styles.table || defaultTableClasses;
            const thClasses = styles.th || defaultThClasses;
            const tdClasses = styles.td || defaultTdClasses;
            const rowClasses = styles.tr || defaultRowClasses;


            // --- HTML Structure Generation ---
            
            let tableContent = '';

            // 1. Caption
            if (caption) {
                tableContent += `<caption class="p-5 text-lg font-semibold text-left text-gray-900 bg-white rounded-t-lg">${caption}</caption>`;
            }

            // 2. Table Header
            const headerCells = processedColumns.map(col => 
                `<th scope="col" class="${thClasses}">${col.label}</th>`
            ).join('');

            tableContent += `
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>${headerCells}</tr>
                </thead>
            `;

            // 3. Table Body
            if (!data || data.length === 0) {
                // Empty state message
                const emptyRow = `
                    <tr>
                        <td colspan="${processedColumns.length}" class="text-center p-12 text-gray-400 italic">
                            ${emptyMessage}
                        </td>
                    </tr>
                `;
                tableContent += `<tbody>${emptyRow}</tbody>`;
            } else {
                
                const rows = data.map((row, rowIndex) => {
                    const rowCells = processedColumns.map(col => {
                        const cellValue = row[col.key] !== undefined ? row[col.key] : 'â€”';
                        
                        // Inline click handler for cell
                        let cellClickAttr = '';
                        if (onCellClick) {
                            // Serialize necessary data for click handler
                            // WARNING: In a production app, use proper event listeners, not inline JS, for functions.
                            const cellDataJson = encodeURIComponent(JSON.stringify(row));
                            cellClickAttr = `onclick="window.handleCellClick('${cellDataJson}', '${col.key}', '${cellValue}', ${rowIndex})" style="cursor: pointer;"`;
                        }

                        return `<td class="${tdClasses}" data-label="${col.label}" ${cellClickAttr}>${cellValue}</td>`;
                    }).join('');

                    // Inline click handler for row
                    let rowClickAttr = '';
                    if (onRowClick) {
                        const rowDataJson = encodeURIComponent(JSON.stringify(row));
                        // Use the first column key as a simple identifiable data point for the log
                        const handlerName = processedColumns[0].key; 
                        rowClickAttr = `onclick="window.handleRowClick('${rowDataJson}', ${rowIndex}, '${handlerName}')" style="cursor: pointer;"`;
                    }
                    
                    // Add responsive classes: 'data-label' attribute helps with mobile view if a custom layout is used
                    return `<tr class="${rowClasses}" ${rowClickAttr}>${rowCells}</tr>`;
                }).join('');

                tableContent += `<tbody>${rows}</tbody>`;
            }

            // 4. Wrap everything in the responsive container and the main table tag
            const finalHtml = `
                <div class="overflow-x-auto rounded-lg ${containerClasses}">
                    <table class="${tableClasses}">${tableContent}</table>
                </div>
            `;
            
            // Return the DomWizard element
            return DomWizard.element(finalHtml);
        };

        // --- Usage Example and Injection ---
        
        // 1. Define Sample Data
        const sampleData = [
            { id: 1, name: 'Alice Smith', email: 'alice@example.com', role: 'Developer', status: 'Active' },
            { id: 2, name: 'Bob Johnson', email: 'bob@example.com', role: 'Designer', status: 'Inactive' },
            { id: 3, name: 'Charlie Brown', email: 'charlie@example.com', role: 'Manager', status: 'Active' },
            { id: 4, name: 'Diana Prince', email: 'diana@example.com', role: 'Analyst', status: 'Active' },
        ];
        
        // 2. Define Columns (mixed strings and objects)
        const sampleColumns = [
            'id', // Simple string key
            { key: 'name', label: 'Full Name' }, // Object with custom label
            'role',
            { key: 'status', label: 'Account Status' } 
        ];

        // 3. Define Custom Styles (optional)
        const customStyles = {
            // Override the default header background color to blue
            th: 'px-4 py-3 text-xs font-medium tracking-wider text-white uppercase bg-blue-600',
        };

        // 4. Define Handlers (optional)
        const handleRow = (rowData, index) => {
            console.log(`Row clicked: ${rowData.name} at index ${index}`);
            // The global handler logs this event to the UI
        };

        const handleCell = (rowData, key, value) => {
            console.log(`Cell clicked: ${key} = ${value} for ${rowData.name}`);
             // The global handler logs this event to the UI
        };
        
        // 5. Instantiate and Render the Widget
        const renderTable = (data) => {
            const tableElement = TableWidget({
                data: data,
                columns: sampleColumns,
                styles: customStyles,
                containerClasses: 'mt-6 border border-blue-400 rounded-xl',
                onRowClick: handleRow,
                onCellClick: handleCell,
                caption: 'Team Member Directory (Clickable)',
                // emptyMessage: 'The directory is currently empty.' // Uncomment to test empty state
            });

            const container = document.getElementById('table-container');
            container.innerHTML = ''; // Clear the loading message
            container.appendChild(tableElement); // Inject the DomWizard element
        };

        // Initial render
        renderTable(sampleData);

    </script>
</body>
</html>
